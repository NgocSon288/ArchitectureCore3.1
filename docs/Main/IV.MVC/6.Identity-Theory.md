# 1. Đăng ký [AppDbContext] vào hệ thống
-
    services.AddDbContext<AppDbContext>(options => {  
        options.UseSqlServer(Configuration.GetConnectionString("AppDbContext"));
    });

# 2. Đăng ký sử dụng [IDentity], ở đây dùng [AppUser] là custom, còn [IdentityRole] là mặc định
- 
    services.AddIdentity<AppUser, IdentityRole>()  
        .AddEntityFrameworkStores<AppDbContext>()   
        .AddDefaultTokenProviders();
 
# 3. Thêm Identity vào Pipeline
- 
    app.UseAuthentication();   // Phục hồi thông tin đăng nhập (xác thực)
    app.UseAuthorization ();   // Phục hồi thông tinn về quyền của User

# 4. [Config] cho [IdentityOptions]
- Truy cập IdentityOptions
    services.Configure<IdentityOptions> (options => {
        // Thiết lập về Password
        options.Password.RequireDigit = false; // Không bắt phải có số
        options.Password.RequireLowercase = false; // Không bắt phải có chữ thường
        options.Password.RequireNonAlphanumeric = false; // Không bắt ký tự đặc biệt
        options.Password.RequireUppercase = false; // Không bắt buộc chữ in
        options.Password.RequiredLength = 3; // Số ký tự tối thiểu của password
        options.Password.RequiredUniqueChars = 1; // Số ký tự riêng biệt

        // Cấu hình Lockout - khóa user
        options.Lockout.DefaultLockoutTimeSpan = TimeSpan.FromMinutes (5); // Khóa 5 phút
        options.Lockout.MaxFailedAccessAttempts = 5; // Thất bại 5 lầ thì khóa
        options.Lockout.AllowedForNewUsers = true;

        // Cấu hình về User.
        options.User.AllowedUserNameCharacters = // các ký tự đặt tên user
            "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._@+";
        options.User.RequireUniqueEmail = true;  // Email là duy nhất

        // Cấu hình đăng nhập.
        options.SignIn.RequireConfirmedEmail = true;            // Cấu hình xác thực địa chỉ email (email phải tồn tại)
        options.SignIn.RequireConfirmedPhoneNumber = false;     // Xác thực số điện thoại

    });

# 5. Trong [MVC-Application] để có thuộc tình [User] kiểu [ClaimsPrincipal] là mẩu tin về User của phiên làm việc
<!-- - SignInManager.IsSignedIn(User)            // Kiểm tra User đã dăng nhập chưa -->
<!-- - UserManager.GetUserName(User)             // UserManager cung cấp nhiều phương thức lấy ra thông tin User -->

# 6. [External-Login]
- Số lượng ExternalLogins
    <!-- IList<AuthenticationScheme> ExternalLogins = (await _signInManager.GetExternalAuthenticationSchemesAsync()).ToList(); -->

# 7. Đối tượng [UserManager]. Các phương thức quan trọng của [UserManager]
- Get Usr][user] kiểu [IdentityUser] từ [User] kiểu [ClaimsPrincipal]

- Tạo ra tài khoản từ dối tượng [IdentityUser] và [Password]
    <!-- _userManager.CreateAsync(user, Input.Password);           -->

- Phát sinh [Token] để xác thức [Email]
    <!-- var code = await _userManager.GenerateEmailConfirmationTokenAsync(user); -->

- Xác thực tài khoản cho [User] khi có [Token], Cần phải thông qua bước [Send-Email] và [Encoder] [Token]
    <!-- _userManager.ConfirmEmailAsync (user, code); -->

- Kiểm tra tài khoản của cần [Confirm-Email] không, tuy thuộc vào [Config] ở [4]. Dùng [_userManager.Options] để kiểm tra các Options đã [Config]
    <!-- _userManager.Options.SignIn.RequireConfirmedEmail -->

- [UserManager] cung cập một số phương thức có sãn để [Get] thông tin [User]
    _UserManager.GetUserName(User)                               // Get Name user
    _userManager.GetPhoneNumberAsync (user);                     // Get phone number

- [UserManager] cung cập một số phương thức có sãn để [Set] thông tin [User]. [Chỉ-set-một-số-dữ-liệu-nhất-định-quan-trọng] [UserName,Email,PhoneNumber]
    _userManager.SetPhoneNumberAsync (user, Input.PhoneNumber);                         // Set phone
    _userManager.ChangePasswordAsync(user, Input.OldPassword, Input.NewPassword);       // Set Password

- [Update] đối với các dữ liệu [Khác]
    _userManager.UpdateAsync(user);

- [Add] [Password] nếu chưa có
    _userManager.AddPasswordAsync(user, Input.NewPassword);

- [Refresh] thông tin [User]
    _signInManager.RefreshSignInAsync (user);

- [Find] [User]
    - [By-Email]
        <!-- var user = await _userManager.FindByEmailAsync(email); -->
    - [UserId]
        <!-- var user = await _userManager.FindByIdAsync (userId); -->

- [Get] danh sách các [Roles] của một [user] nào đó
    <!-- _userManager.GetRolesAsync(user); -->

- [Add] [Role] cho [user]
    <!-- _userManager.AddToRoleAsync(user, rolename); -->

- [Remove] [Role] cho [user]
    <!-- _userManager.RemoveFromRoleAsync(user, rolename); -->

- [Check] [User]
    - Check [Password]
        <!-- await _userManager.HasPasswordAsync(user); -->

- [user.EmailConfirmed] để kiểm tra [Basic] là [User] đã Confirm chưa

# 8. Đối tượng [SignInManager]
- Đăng nhập cho một [User], và trả  về một  [result] là đối tượng của 
    <!-- _signInManager.SignInAsync(user, false); -->   // Khi đã tìm User
    Hoặc 
    <!-- _signInManager.PasswordSignInAsync (Input.UserNameOrEmail, Input.Password, Input.RememberMe, true); --> // Khi chưa  Tỉm User
    Hoặc
    <!-- _signInManager.PasswordSignInAsync ( user, Input.Password, Input.RememberMe, true ); -->   // Tìm ra User và có nhiều Options

    - [result.Succeeded] kiểm tra đăng nhập thành công không
    - [result.RequiresTwoFactor] có đăng nhập 2 yều tố hay không
    - [result.IsLockedOut] kiểm tra tài khoản có bị khóa không, tuy thuộc vào [Config]



- Kiểm tra [User] hiện tại  có đăng nhập không
    <!-- _signInManager.IsSignedIn(User) -->

- [SignOut] cho [User] hiện tại
    <!-- await _signInManager.SignOutAsync(); -->

- Clear the existing external cookie to ensure a clean login process
    <!-- await HttpContext.SignOutAsync (IdentityConstants.ExternalScheme); -->

# 9. Đối tượng [RoleManager]
- [Get] danh sách tất cả các [IdentityRole]
    <!-- List<IdentityRole> roles  =  await _roleManager.Roles.ToListAsync(); -->

- [Get] danh sách các [Roles] của một [user] nào đó
    <!-- _userManager.GetRolesAsync(user); --

- [Create] [IdentityRole]. [identityRole] là đối tượng của [IdentityRole]
    <!-- await _roleManager.CreateAsync(identityRole); -->
- Cập nhật [Role]
    var result = await _roleManager.FindByIdAsync (Input.ID);       // Tìm ra Role
    result.Name = Input.Name;                                       //  Sửa tên
    var roleUpdateRs = await _roleManager.UpdateAsync (result);     // Cập nhật thông  qua đối tượng [RoleManager]


- [Delete] [IdentityRole]. [identityRole] là đối tượng của [IdentityRole]
    <!-- await _roleManager.DeleteAsync(identityRole); -->

- [Check] [IdentityRole] [Exists]
    <!-- await _roleManager.RoleExistsAsync(roleName); -->

- [Find]
    - [By-ID]
        <!-- FindByIdAsync -->
    - [By-Name]
        <!-- FindByNameAsync -->

- VD: [Add-Role-To-Current-User]
    <!-- 
        var cuser = await _userManager.GetUserAsync(User);
        await _userManager.AddToRolesAsync(cuser, new string[] { "Editor"}); 
    -->

- [Add] [Role] cho [user]
    <!-- _userManager.AddToRoleAsync(user, rolename); -->

- [Remove] [Role] cho [user]
    <!-- _userManager.RemoveFromRoleAsync(user, rolename); -->


# 10. 